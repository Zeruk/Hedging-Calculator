function computeHedge(){clearTable();for(var t=new Date(jQuery("#beginDate").val()),e=new Date(jQuery("#endDate").val()),r=Number(jQuery("#currentRate").val()/100),d=Number(jQuery("#currency").val()),n=Number(jQuery("#strike1").val()),a=Number(jQuery("#strike2").val()),i=t,u=daysBetween(e,t)/30;u>0;u--){daysBetween(i,t);var l=computeForwardCurrency(t,i,r,d),o=daysBetween(i,t),h=o/365>0?o/365:Math.pow(10,-10),c=computeStrike(n,l,.14,h),s=computeStrike(a,l,.14,h),p=c.call-s.put,y=p/d*100,b=l-d,m=b/d*100;jQuery("#results > tbody:nth-child(1) > tr:nth-child(1)").append("<td>"+i.getDate().toString()+"."+(i.getMonth()+1).toString()+"."+i.getFullYear().toString()+"</td>"),jQuery("#results > tbody:nth-child(1) > tr:nth-child(2)").append("<td>"+h.toFixed(4)+"</td>"),jQuery("#results > tbody:nth-child(1) > tr:nth-child(3)").append("<td>"+r+"</td>"),jQuery("#results > tbody:nth-child(1) > tr:nth-child(4)").append("<td>"+l.toFixed(4)+"</td>"),jQuery("#results > tbody:nth-child(1) > tr:nth-child(5)").append("<td>"+(.14*100).toFixed(0)+"%</td>"),jQuery("#results > tbody:nth-child(1) > tr:nth-child(6)").append("<td>"+c.call.toFixed(4)+"</td>"),jQuery("#results > tbody:nth-child(1) > tr:nth-child(7)").append("<td>"+c.put.toFixed(4)+"</td>"),jQuery("#results > tbody:nth-child(1) > tr:nth-child(8)").append("<td>"+s.call.toFixed(4)+"</td>"),jQuery("#results > tbody:nth-child(1) > tr:nth-child(9)").append("<td>"+s.put.toFixed(4)+"</td>"),jQuery("#results > tbody:nth-child(1) > tr:nth-child(10)").append("<td>"+p.toFixed(4)+"</td>"),jQuery("#results > tbody:nth-child(1) > tr:nth-child(11)").append("<td>"+y.toFixed(4)+"%</td>"),jQuery("#results > tbody:nth-child(1) > tr:nth-child(12)").append("<td>"+b.toFixed(4)+"</td>"),jQuery("#results > tbody:nth-child(1) > tr:nth-child(13)").append("<td>"+m.toFixed(4)+"%</td>"),i=addMonths(i,1)}}function clearTable(){jQuery("#results").empty(),jQuery("#results").append("<tr><td>Дата исполнения</td></tr>\n<tr><td>Полных лет</td></tr>\n<tr><td>Текущая ставка денежного рынка %%</td></tr>\n<tr><td>Курс валюты</td></tr>\n<tr><td>Волатильность</td></tr>\n<tr><td>Страйк 1: Стоимость опциона Call</td></tr>\n<tr><td>Страйк 1: Стоимость опциона Put</td></tr>\n<tr><td>Страйк 2: Стоимость опциона Call</td></tr>\n<tr><td>Страйк 2: Стоимость опциона Put</td></tr>\n<tr><td>Ст-ть хеджа по связке опционов (Руб за Евро)</td></tr>\n<tr><td>Ст-ть хеджа по связке опционов (в %%)</td></tr>\n<tr><td>Ст-ть хеджа по форварду (Руб за Евро)</td></tr>\n<tr><td>Ст-ть хеджа по форварду (в %%)</td></tr>")}function addMonths(t,e){return result=new Date(t),new Date(result.setMonth(result.getMonth()+e))}function computeForwardCurrency(t,e,r,d){return r/365*daysBetween(e,t)*d+d}function daysBetween(t,e){return Math.round(Math.abs(e.valueOf()-t.valueOf())/864e5)}function normalcdf(t){var e=1/(1+.2316419*Math.abs(t)),r=.3989423*Math.exp(-t*t/2)*e*(.3193815+e*(e*(1.781478+e*(1.330274*e-1.821256))-.3565638));return t>0&&(r=1-r),r}function normalDistribF(t){return Math.pow(2*Math.PI,-.5)*Math.pow(Math.E,-t*t/2)}function normalDistrib(X,variant){with(Z=X,M=0,SD=1,Math)Prob=1===variant?normalDistribF(X):normalcdf(X),Prob=round(1e8*Prob)/1e8;return Prob}function computeStrike(t,e,r,d){var n=(Math.log(e/t)+.5*Math.pow(r,2)*d)/(r*Math.pow(d,.5)),a=n-r*Math.pow(d,.5),i=normalDistrib(n),u=normalDistrib(a),l=normalDistribF(n),o=normalDistrib(-n),h=normalDistrib(-a);return{d1:n,d2:a,Nd1:i,Nd2:u,Nfd1:l,N_d1:o,N_d2:h,call:e*i-t*u,put:t*h-e*o}}addEventListener("DOMContentLoaded",function(){pickmeup("input#beginDate",{position:"right",hide_on_select:!0,format:"Y-m-d"}),pickmeup("input#endDate",{position:"right",hide_on_select:!0,format:"Y-m-d",default_date:!1})});